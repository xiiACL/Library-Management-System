<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-black dark:text-white p-4">
  <div class="max-w-4xl mx-auto">

    <!-- Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ -->
    <div class="flex justify-end mb-4">
      <button onclick="toggleDarkMode()" class="px-4 py-2 bg-gray-800 text-white rounded">
        ğŸŒ™ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
      </button>
    </div>

    <h1 class="text-3xl font-bold mb-4 text-center">ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ</h1>

    <form action="/Books" method="GET" class="mb-6 flex items-center gap-2 flex-wrap" id="searchForm">
      <input
        type="text"
        name="q"
        placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨..."
        value="{{ search }}"
        class="flex-1 px-4 py-2 rounded border dark:bg-gray-700 dark:border-gray-600"
      />
      <select name="sort" class="px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600" onchange="document.getElementById('searchForm').submit()">
        <option value="">ğŸ”€ ØªØ±ØªÙŠØ¨</option>
        <option value="last_read" {% if sort == 'last_read' %}selected{% endif %}>ğŸ“– Ø§Ù„Ø£Ø­Ø¯Ø« Ù‚Ø±Ø§Ø¡Ø©</option>
        <option value="created_at" {% if sort == 'created_at' %}selected{% endif %}>ğŸ—“ï¸ Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ø¶Ø§ÙØ©</option>
      </select>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">ğŸ” Ø¨Ø­Ø«</button>
      <a href="/add" class="bg-green-600 text-white px-4 py-2 rounded">â• Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨</a>
    </form>

    <h2 class="text-lg mb-4">ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØªØ¨: {{ books|length }}</h2>

    <div class="grid gap-4">
      {% for book in books %}
      <div class="bg-white dark:bg-gray-800 text-black dark:text-white shadow-md rounded p-4 flex gap-4 items-center">
        {% if book[9] %}
          <img src="{{ url_for('uploaded_file', filename=book[9]) }}" alt="ØºÙ„Ø§Ù {{ book[1] }}" class="w-48 h-auto rounded" />
        {% else %}
          <div class="w-48 h-64 bg-gray-300 dark:bg-gray-600 rounded flex items-center justify-center text-gray-600 dark:text-gray-300">
            Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©
          </div>
        {% endif %}

        <div class="flex-1">
          <p class="text-xl font-bold mb-2">{{ book[1] }}</p>
          <p>ğŸ‘¤ Ø§Ù„Ù…Ø¤Ù„Ù: {{ book[2] or 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' }}</p>
          <p>ğŸ·ï¸ Ø§Ù„ØªØµÙ†ÙŠÙ: {{ book[3] or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</p>
          {% if book[12] %}
            <p>ğŸ“š Ø§Ù„Ø³Ù„Ø³Ù„Ø©: {{ book[12] }}{% if book[13] %} - Ø§Ù„Ø¬Ø²Ø¡ {{ book[13] }}{% endif %}</p>
          {% endif %}
          <p>ğŸ“„ Ø§Ù„ØµÙØ­Ø©: {{ book[5] }}/{{ book[4] }}</p>
          <p>ğŸ“˜ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {{ book[4] - book[5] }} ØµÙØ­Ø©</p>
          <p>ğŸ›’ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡: {{ book[6] or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</p>
          {% if book[7] %}
            <p>ğŸ“– Ø¢Ø®Ø± Ù‚Ø±Ø§Ø¡Ø©: {{ book[7].replace('T', ' ') }}</p>
          {% else %}
            <p>ğŸ“– Ø¢Ø®Ø± Ù‚Ø±Ø§Ø¡Ø©: ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©</p>
          {% endif %}
          <p>ğŸ“š Ø§Ù„Ù†ÙˆØ¹: {{ book[8] or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</p>
          <p>ğŸ—“ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©: {{ book[10] or 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}</p>
          <p>âœï¸ Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: {{ book[11] or 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}</p>

          <form action="/update_page/{{ book[0] }}" method="POST" class="mt-4 flex items-center gap-2 flex-wrap">
            <input
              type="number"
              name="current_page"
              min="0"
              max="{{ book[4] }}"
              value="{{ book[5] }}"
              class="w-24 px-2 py-1 border rounded dark:bg-gray-700 dark:border-gray-600"
              required
            />
            <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©</button>
            <a href="/edit/{{ book[0] }}" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
          </form>
        </div>
      </div>
      {% else %}
      <p class="text-center text-gray-500 dark:text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
      {% endfor %}
    </div>
  </div>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
  <script>
    if (!localStorage.getItem('theme')) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    } else if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    function toggleDarkMode() {
      const html = document.documentElement;
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    }
  </script>
</body>
</html>
