<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>๐ ููุชุจุชู</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-4xl mx-auto">

    <h1 class="text-3xl font-bold mb-4 text-center">๐ ููุชุจุชู</h1>

    <form action="/Books" method="GET" class="mb-6 flex items-center gap-2 flex-wrap" id="searchForm">
      <input
        type="text"
        name="q"
        placeholder="ุงุจุญุซ ุนู ูุชุงุจ..."
        value="{{ search }}"
        class="flex-1 px-4 py-2 rounded border bg-gray-700 border-gray-600"
      />
      <select name="sort" class="px-3 py-2 border rounded bg-gray-700 border-gray-600" onchange="document.getElementById('searchForm').submit()">
        <option value="">๐ ุชุฑุชูุจ</option>
        <option value="last_read" {% if sort == 'last_read' %}selected{% endif %}>๐ ุงูุฃุญุฏุซ ูุฑุงุกุฉ</option>
        <option value="created_at" {% if sort == 'created_at' %}selected{% endif %}>๐๏ธ ุงูุฃุญุฏุซ ุฅุถุงูุฉ</option>
      </select>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">๐ ุจุญุซ</button>
      <a href="/add" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">โ ุฅุถุงูุฉ ูุชุงุจ</a>
    </form>

    <h2 class="text-lg mb-4">๐ฆ ุนุฏุฏ ุงููุชุจ: {{ books|length }}</h2>

    <div class="grid gap-4">
      {% for book in books %}
      <div class="bg-gray-800 text-white shadow-md rounded p-4 flex flex-col md:flex-row gap-4">

        <!-- ุตูุฑุฉ ุงูุบูุงู -->
        {% if book[9] %}
          <img src="{{ url_for('uploaded_file', filename=book[9]) }}" alt="ุบูุงู {{ book[1] }}" class="w-32 h-48 object-cover rounded shadow" />
        {% else %}
          <div class="w-32 h-48 bg-gray-600 rounded flex items-center justify-center text-gray-300">
            ูุง ุชูุฌุฏ ุตูุฑุฉ
          </div>
        {% endif %}

        <!-- ุชูุงุตูู ุงููุชุงุจ -->
        <div class="flex-1">
          <p class="text-xl font-bold mb-2">{{ book[1] }}</p>
          <p>๐ค ุงููุคูู: {{ book[2] or 'ุบูุฑ ูุนุฑูู' }}</p>
          <p>๐ท๏ธ ุงูุชุตููู: {{ book[3] or 'ุบูุฑ ูุญุฏุฏ' }}</p>
          {% if book[12] %}
            <p>๐ ุงูุณูุณูุฉ: {{ book[12] }}{% if book[13] %} - ุงูุฌุฒุก {{ book[13] }}{% endif %}</p>
          {% endif %}
          <p>๐ ุงูุตูุญุฉ: {{ book[5] }}/{{ book[4] }}</p>
          <p>๐ ุงููุชุจูู: {{ book[4] - book[5] }} ุตูุญุฉ</p>

          <!-- ุดุฑูุท ุงูุชูุฏู -->
          <div class="w-full bg-gray-700 rounded h-2 mt-2">
            <div class="bg-blue-600 h-2 rounded" style="width: {{ (book[5] / book[4]) * 100 if book[4] else 0 }}%"></div>
          </div>

          <p class="mt-2">๐ ุชุงุฑูุฎ ุงูุดุฑุงุก: {{ book[6] or 'ุบูุฑ ูุญุฏุฏ' }}</p>
          {% if book[7] %}
            <p>๐ ุขุฎุฑ ูุฑุงุกุฉ: {{ book[7].replace('T', ' ') }}</p>
          {% else %}
            <p>๐ ุขุฎุฑ ูุฑุงุกุฉ: ุบูุฑ ูุญุฏุฏุฉ</p>
          {% endif %}
          <p>๐ ุงูููุน: {{ book[8] or 'ุบูุฑ ูุญุฏุฏ' }}</p>
          <p>๐๏ธ ุชุงุฑูุฎ ุงูุฅุถุงูุฉ: {{ book[10] or 'ุบูุฑ ูุชููุฑ' }}</p>
          <p>โ๏ธ ุขุฎุฑ ุชุนุฏูู: {{ book[11] or 'ุบูุฑ ูุชููุฑ' }}</p>

          <!-- ุฃุฒุฑุงุฑ ุงูุชุญุฏูุซ -->
          <form action="/update_page/{{ book[0] }}" method="POST" class="mt-4 flex items-center gap-2 flex-wrap">
            <input
              type="number"
              name="current_page"
              min="0"
              max="{{ book[4] }}"
              value="{{ book[5] }}"
              class="w-24 px-2 py-1 border rounded bg-gray-700 border-gray-600"
              required
            />
            <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition">๐พ ุชุญุฏูุซ</button>
            <a href="/edit/{{ book[0] }}" class="bg-yellow-400 text-black px-3 py-1 rounded hover:bg-yellow-500 transition">โ๏ธ ุชุนุฏูู</a>
            <a href="/delete/{{ book[0] }}" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition">๐๏ธ ุญุฐู</a>
          </form>
        </div>
      </div>
      {% else %}
      <p class="text-center text-gray-400">ูุง ุชูุฌุฏ ูุชุจ ุญุงููุงู</p>
      {% endfor %}
    </div>
  </div>
</body>
</html>
